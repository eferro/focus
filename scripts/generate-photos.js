#!/usr/bin/env node
import fs from 'fs';
import path from 'path';

// Directories
const PHOTOS_DIR = path.join(process.cwd(), 'public/photos');
const OUT_DIR = path.join(process.cwd(), 'src/generated');
const OUT_FILE = path.join(OUT_DIR, 'photos.ts');

function main() {
  if (!fs.existsSync(PHOTOS_DIR)) {
    console.error(`Photos directory not found: ${PHOTOS_DIR}`);
    process.exit(1);
  }
  // List only generated webp photos matching photo_####.webp
  const files = fs.readdirSync(PHOTOS_DIR)
    .filter(name => /^photo_\d{4}\.webp$/.test(name))
    .sort();

  if (!fs.existsSync(OUT_DIR)) {
    fs.mkdirSync(OUT_DIR, { recursive: true });
  }
  const total = files.length;
  // Build PHOTOS array and TOTAL_PHOTOS
  const photoList = files.map(f => `  '${f}',`).join('\n');
  const content = `// This file is auto-generated by scripts/generate-photos.js
export const PHOTOS = [
${photoList}
] as const;
export const TOTAL_PHOTOS = PHOTOS.length;
`;
  fs.writeFileSync(OUT_FILE, content, 'utf-8');
  console.log(`Generated ${OUT_FILE} with TOTAL_PHOTOS=${total}`);
}

main();